# Stake contract

WIP!

## Description

Есть 2 типа токенов
токены проекта (rewards)
токены ликвидности (назовем bpt)

Основной функционал контракта - в честном распределение reward-токенов.
В течении жизни контракта, каждые n-дней (исходя из параметра 2 в конструкторе) происходит начисление на внутренний счет reward токенов тем пользователям, которые передали на контракт BPT-токены. Расчет производится пропорционально в зависимости от общего количества BPT-токенов ими залоченных на момент запуска распределителя.

Пример1:
На смарт контракте залочено 30 reward-токенов на срок 3 дня, с распределением каждый день. Соответственно ежедневно будет распределяться 10 reward-токенов
Пользователь Алиса в первый день залочила 2 BPT-токена, пользователь Боб залочил 1 BPT токен.
В первый день смарт контракт разблокирует 10 reward-токенов. 6.66 reward-токенов будет зачислено на внутренний счет Алисы, и 3.33 на внутренний счет Боба.
Если пользователи не делали вывод - то через три дня Алиса сможет вывести 20 reward-токенов, Боб - 10 reward-токенов. 

Пример 2:
На смарт контракте залочено 30 reward-токенов на срок 3 дня, с распределением каждый день.
Пользователи Алиса и Боб залочили каждый по 1 BPTтокену
В первый день смарт контракт разблокирует 10 reward-токенов. На внутренний счет Алисы будет зачислено 5 reward-токенов, и на счет Боба тоже 5 reward-токенов.
До запуска распределителя во второй день Алиса вывела свой 1 BPTтокен.
Во время второго запуска распределителя т.к. на контракте залочен BPT-токен только Боба - то на его внутренний счет ему будет зачислены все 10 reward-токенов.
После окончания действия контракта (3 распределения) Алиса может запросить вывод 5 reward-токенов, а Боб сможет вывести 25 reward-токенов.


Конструктор 
Должен принимать значения:
1) Срок действия контракта (в днях), минимально 1 день.
2) Значение с шагом в 1 день, как часто будут распределяться токены.
3) Холд в днях на вывод BPT-токенов.
4) адрес токена bpt
5) адрес токена rewards

Отдельным методом owner контракта должен положить и зафиксировать на контракте какое-то кол-во reward-токенов, которые и будут распределяться.

Прием BPT от пользователей.
Пользователи отправляют на контракт ERC-20 токены BPT, мы фиксируем количество. В свою очередь в контракте появляется у каждого из пользователей внутренний баланс (программный).

read-методы
Общедоступные методы:
- показать общее текущее количество залоченных BPT-токенов

write-методы
у каждого из пользователей положивших BPT-токены должны быть свои методы:
- deposit (размещение пользователем bpt-токенов)
- withdrawRewards. вывести свои reward-токены (произвольное количество). Если только их у пользователя есть эти токены (участвовал в распределении и не вывел все).
- withdrawBPT. вывести свои BPT токены (произвольное количество). В конструкторе есть параметр холда - минимум через сколько дней пользователь сможет вывести свои BPT токены. К примеру если указано 10, значит пользователь сможет вывести свои BPT токены только через 10 дней после размещения.

У owner-а контракта должны быть методы
- burn или revert нераспределенных erc-20 токенов. Метод будет работать только в том случае если не было ни одного распределения или если остались эти токены на счету после завершения срока действия контракта. Ситуация может возникнуть, когда пользователь положил BPT-токены, но потом вывел и в последующих распределениях не было залочено ни одного BPT-токена. Метод можно будет запустить только после окончания срока действия контракта.


## Sheme how to test.
<pre>
periods     - 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30

who deposit - 0 0 0 0 0 x x x x x  xy xy xy xy xy  0  0  0  0  0 xyz..
</pre>

x=5

y=15

z=20

allReward=30000

period count = 30

reward for 1 period rp=30000/30=1000

x reward = 5 * rp+5 * rp * x/(x+y)+10 * rp * x/(x+y+z)=7500

y reward = 5 * rp * y/(x+y)+10 * rp * y/(x+y+z)=7500

z reward = 10 * rp * z/(x+y+z)=5000

unused reward = 10 * rp=10000
